<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNAKE TITAN: ULTIMATE GENESIS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        :root {
            --primary-color: #00ff88;
            --secondary-color: #ff0055;
            --background-dark: #0f0f1a;
            --font-pixel: 'Press Start 2P', cursive;
        }

        body {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            background-color: #000;
            color: var(--primary-color);
            font-family: var(--font-pixel);
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; user-select: none;
        }

        #crt-container {
            position: relative;
            padding: 20px;
            background: #222;
            border: 8px solid #444;
            border-radius: 15px;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.5), 0 15px 40px rgba(0,0,0,1);
        }

        #crt-container::before {
            content: "";
            display: block; position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            z-index: 2; background-size: 100% 3px, 3px 100%;
            pointer-events: none;
        }

        canvas {
            display: block;
            background-color: var(--background-dark);
            image-rendering: pixelated;
            transition: background-color 0.8s ease;
        }

        .hud {
            position: absolute;
            top: -50px; width: 100%;
            display: flex; justify-content: space-between;
            font-size: 10px;
        }

        #combo-meter {
            position: absolute;
            left: -80px; height: 250px; width: 20px;
            background: #111; border: 2px solid #333;
            top: 50%; transform: translateY(-50%);
        }

        #combo-fill {
            position: absolute; bottom: 0; width: 100%;
            background: linear-gradient(to top, var(--secondary-color), var(--primary-color));
            height: 0%; transition: height 0.1s linear;
        }

        #multiplier-text {
            position: absolute; top: -30px; left: -15px;
            width: 50px; text-align: center; font-size: 12px; color: var(--secondary-color);
        }

        #achievement-popup {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primary-color); color: #000;
            padding: 15px; font-size: 10px; border: 2px solid #000;
            display: none; z-index: 20;
        }

        #game-menu {
            position: absolute; inset: 0;
            background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100;
        }

        input[type="color"] {
            width: 50px; height: 50px; border: none; cursor: pointer; background: transparent;
        }

        button {
            background: var(--primary-color); border: none;
            padding: 15px 30px; font-family: var(--font-pixel);
            font-size: 12px; cursor: pointer; color: #000; margin-top: 20px;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="crt-container">
        <div class="hud">
            <div>SCORE:<span id="score-val">0000</span></div>
            <div>LVL:<span id="lvl-val">1</span></div>
            <div>HI:<span id="hi-score-val">0000</span></div>
        </div>

        <div id="combo-meter">
            <div id="multiplier-text">X1</div>
            <div id="combo-fill"></div>
        </div>

        <div id="achievement-popup">LEVEL UP!</div>

        <canvas id="gameCanvas" width="600" height="600"></canvas>

        <div id="game-menu">
            <h1 style="color:var(--primary-color)">TITAN GENESIS</h1>
            <div style="text-align:center; margin: 20px;">
                <p style="font-size: 8px;">PICK SNAKE COLOR:</p>
                <input type="color" id="snakeColorPicker" value="#00ff88">
            </div>
            <button id="startButton">START SYSTEM</button>
        </div>
    </div>

<script>
const Config = {
    GRID: 30,
    CELLS: 20,
    THEMES: [
        { bg: '#0f0f1a', hat: '#ffffff', walls: [] },
        { bg: '#0f1a1a', hat: '#ffcc00', walls: [{x:5,y:5}, {x:14,y:5}, {x:5,y:14}, {x:14,y:14}] },
        { bg: '#1a0f1a', hat: '#00ccff', walls: [{x:9,y:0}, {x:10,y:0}, {x:9,y:19}, {x:10,y:19}, {x:0,y:9}, {x:19,y:9}] },
        { bg: '#1a1a0f', hat: '#ff00ff', walls: [{x:4,y:4}, {x:15,y:4}, {x:4,y:15}, {x:15,y:15}] },
        { bg: '#1a0505', hat: '#ff3300', walls: [{x:7,y:7}, {x:8,y:7}, {x:11,y:7}, {x:12,y:7}, {x:7,y:12}, {x:12,y:12}] }
    ]
};

const Game = {
    canvas: document.getElementById('gameCanvas'),
    ctx: document.getElementById('gameCanvas').getContext('2d'),
    snake: [],
    food: null,
    walls: [],
    particles: [],
    direction: {x: 1, y: 0},
    nextDirection: {x: 1, y: 0},
    score: 0,
    level: 1,
    combo: 0,
    comboTimer: 0,
    snakeColor: '#00ff88',
    isRunning: false,

    init() {
        document.getElementById('startButton').addEventListener('click', () => this.start());
        window.addEventListener('keydown', (e) => this.handleInput(e));
        this.highScore = localStorage.getItem('titanHi') || 0;
        document.getElementById('hi-score-val').innerText = String(this.highScore).padStart(4, '0');
    },

    handleInput(e) {
        const key = e.key.toLowerCase();
        const m = {
            'w':{x:0,y:-1}, 'arrowup':{x:0,y:-1},
            's':{x:0,y:1},  'arrowdown':{x:0,y:1},
            'a':{x:-1,y:0}, 'arrowleft':{x:-1,y:0},
            'd':{x:1,y:0},  'arrowright':{x:1,y:0}
        };
        if(m[key]) {
            const next = m[key];
            if(next.x !== -this.direction.x && next.y !== -this.direction.y) this.nextDirection = next;
        }
    },

    start() {
        this.snakeColor = document.getElementById('snakeColorPicker').value;
        this.snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
        this.direction = {x: 1, y: 0};
        this.nextDirection = {x: 1, y: 0};
        this.score = 0;
        this.level = 1;
        this.combo = 0;
        this.comboTimer = 0;
        this.isRunning = true;
        this.walls = Config.THEMES[0].walls;
        document.getElementById('game-menu').classList.add('hidden');
        this.spawnFood();
        this.loop();
    },

    spawnFood() {
        this.food = { x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20) };
        if(this.snake.some(p => p.x === this.food.x && p.y === this.food.y) || 
           this.walls.some(w => w.x === this.food.x && w.y === this.food.y)) this.spawnFood();
    },

    update() {
        this.direction = this.nextDirection;
        const head = { x: this.snake[0].x + this.direction.x, y: this.snake[0].y + this.direction.y };

        if(head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || 
           this.snake.some(p => p.x === head.x && p.y === head.y) ||
           this.walls.some(w => w.x === head.x && w.y === head.y)) return this.gameOver();

        this.snake.unshift(head);

        if(head.x === this.food.x && head.y === this.food.y) {
            this.score += 10 * (this.combo + 1);
            this.combo = Math.min(this.combo + 1, 4);
            this.comboTimer = 100;
            this.createExplosion(this.food.x*30+15, this.food.y*30+15);
            this.spawnFood();
            
            let newLvl = Math.min(5, Math.floor(this.score / 150) + 1);
            if(newLvl > this.level) {
                this.level = newLvl;
                this.walls = Config.THEMES[this.level-1].walls;
                this.showAchievement();
            }
        } else {
            this.snake.pop();
        }

        if(this.comboTimer > 0) this.comboTimer -= 1.5; else this.combo = 0;
        this.updateHUD();
    },

    createExplosion(x, y) {
        for(let i=0; i<10; i++) {
            this.particles.push({
                x, y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, 
                life: 1.0, color: this.snakeColor
            });
        }
    },

    updateHUD() {
        document.getElementById('score-val').innerText = String(this.score).padStart(4, '0');
        document.getElementById('lvl-val').innerText = this.level;
        document.getElementById('combo-fill').style.height = this.comboTimer + '%';
        document.getElementById('multiplier-text').innerText = 'X' + (this.combo + 1);
        this.canvas.style.backgroundColor = Config.THEMES[this.level-1].bg;
    },

    showAchievement() {
        const p = document.getElementById('achievement-popup');
        p.style.display = 'block';
        setTimeout(() => p.style.display = 'none', 1500);
    },

    draw() {
        this.ctx.clearRect(0, 0, 600, 600);
        
        // Walls
        this.ctx.fillStyle = '#444';
        this.walls.forEach(w => this.ctx.fillRect(w.x*30, w.y*30, 30, 30));

        // Food
        this.ctx.fillStyle = '#ff0055';
        this.ctx.fillRect(this.food.x*30+5, this.food.y*30+5, 20, 20);

        // Snake
        this.snake.forEach((p, i) => {
            this.ctx.fillStyle = (i === 0) ? '#fff' : this.snakeColor;
            this.ctx.fillRect(p.x*30+2, p.y*30+2, 26, 26);
            if(i === 0 && this.level > 1) this.drawHat(p.x*30+15, p.y*30+15);
        });

        // Particles
        this.particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.life -= 0.02;
            this.ctx.globalAlpha = p.life;
            this.ctx.fillStyle = p.color;
            this.ctx.fillRect(p.x, p.y, 4, 4);
            if(p.life <= 0) this.particles.splice(i, 1);
        });
        this.ctx.globalAlpha = 1;
    },

    drawHat(x, y) {
        this.ctx.fillStyle = Config.THEMES[this.level-1].hat;
        this.ctx.beginPath();
        this.ctx.moveTo(x-10, y-10); this.ctx.lineTo(x-10, y-22); this.ctx.lineTo(x-5, y-16);
        this.ctx.lineTo(x, y-28); this.ctx.lineTo(x+5, y-16); this.ctx.lineTo(x+10, y-22);
        this.ctx.lineTo(x+10, y-10); this.ctx.fill();
    },

    loop() {
        if(!this.isRunning) return;
        this.update();
        this.draw();
        setTimeout(() => requestAnimationFrame(() => this.loop()), 100 - (this.level*8));
    },

    gameOver() {
        this.isRunning = false;
        if(this.score > this.highScore) {
            this.highScore = this.score;
            localStorage.setItem('titanHi', this.score);
        }
        document.getElementById('game-menu').classList.remove('hidden');
        document.getElementById('hi-score-val').innerText = String(this.highScore).padStart(4, '0');
    }
};

Game.init();
</script>
</body>
</html>
